
âœ… VR License Management MVP â€“ Backend Requirements
==================================================

ğŸ” Auth (Supabase)
------------------
- Use Supabase Auth for employee login (email/password only)
- Supabase JWT tokens should be verified in NestJS via a custom guard
- Attach req.user from JWT payload to each request
- Optional: Store user roles (e.g. admin, employee) in a separate Employee table

ğŸ‘¥ Roles
--------
Employee:
- Can view available licenses
- Can activate a license key
- Can view license usage and total owed per vendor

Vendor:
- Can upload license keys (via dashboard, or API if extended)
- Can view how many license keys are: Available, Activated, Canceled
- Can view how much money the VR company owes them per month

ğŸ“¦ Data Models (Prisma)
-----------------------
Vendor
- id, name, contactEmail, createdAt, updatedAt

Software
- id, name, vendorId (FK), pricingModel (enum), pricePerUse, monthlyRate, createdAt, updatedAt

LicenseKey
- id, key (unique), status (enum: available, activated, canceled), vendorId, softwareId, activatedAt,
  activatedById (FK), canceledAt, createdAt, updatedAt

Employee
- id, name, email (unique), role (enum: admin, employee), createdAt, updatedAt

Activation
- id, licenseKeyId (FK), employeeId (FK), vendorId, softwareId, activatedAt, headsetSerialNumber (optional), createdAt

(Optional) MonthlyUsage
- vendorId, softwareId, month, usageCount, totalOwed, calculatedAt

ğŸ“Š Key Features / API Endpoints
-------------------------------
ğŸ” Auth
- POST /auth/login â†’ handled by Supabase client (frontend)
- Supabase JWTs must be validated by backend guard

ğŸ‘¨â€ğŸ”§ Employee Routes
- GET /licenses/available â†’ show grouped available licenses
- POST /licenses/:id/activate â†’ confirm + mark a license as activated
- GET /vendors/owed â†’ view total owed per vendor

ğŸ‘¨â€ğŸ’» Vendor Routes
- POST /licenses/upload â†’ upload license keys (CSV or JSON array)
- GET /licenses/status-summary â†’ counts of available / activated / canceled
- GET /revenue/monthly â†’ see expected monthly revenue based on usage

ğŸ›¡ Business Logic
-----------------
- A license key can only be activated if status is 'available'
- Activating a key sets:
  - status â†’ 'activated'
  - activatedAt â†’ now
  - activatedById â†’ current employee
- License keys must not be visible until activated (secure confirmation step)
- Activated keys count toward vendorâ€™s monthly owed total based on their pricingModel
- Vendors can cancel keys (optional stretch goal)

ğŸ§ª Environment / Setup
-----------------------
- NestJS + Prisma + PostgreSQL
- Supabase Auth (external)
- Local .env with:
  - DATABASE_URL
  - SUPABASE_URL
  - SUPABASE_SERVICE_ROLE_KEY
  - SUPABASE_JWT_SECRET
